@page
@model RegisterModel
<div class="container mt-5">
    <style>
        .centered-form {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

            .centered-form form {
                width: 100%;
                max-width: 600px;
            }

        .separator {
            position: relative;
            text-align: center;
            width: 100%;
            margin: auto;
        }

        .or {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 0 10px;
        }

        .form-label {
            margin-bottom: 5px;
        }

        .form-control, .form-select, .btn {
            width: 100%;
            margin-bottom: 15px;
        }

        @@media (max-width: 768px) {
            .form-control, .form-select, .btn {
                margin-bottom: 10px;
            }
        }
    </style>
    <div class="centered-form" style="margin-top: -40px;">
        <h3 class="text-primary text-center">Register Account</h3>
        <hr />
        <form id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post">
            <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>
            <div class="form-floating mb-3">
                <input asp-for="Input.FName" type="text" class="form-control" id="Input_FName" placeholder="First Name">
                <label for="Input.FName" class="form-label">First Name</label>
                <span asp-validation-for="Input.FName" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.LName" type="text" class="form-control" id="Input_LName" placeholder="Last Name">
                <label for="Input.LName" class="form-label">Last Name</label>
                <span asp-validation-for="Input.LName" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.Email" type="email" class="form-control" id="Input_Email" placeholder="Email">
                <label for="Input.Email" class="form-label">Email</label>
                <span asp-validation-for="Input.Email" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.PhoneNumber" type="text" class="form-control" id="Input_PhoneNumber" placeholder="Phone Number">
                <label for="Input.PhoneNumber" class="form-label">Phone Number</label>
                <span asp-validation-for="Input.PhoneNumber" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.Street" type="text" class="form-control" id="Input_Street" placeholder="Street">
                <label for="Input.Street" class="form-label">Street</label>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.City" type="text" class="form-control" id="Input_City" placeholder="City">
                <label for="Input.City" class="form-label">City</label>
                <span asp-validation-for="Input.City" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <select asp-for="Input.State" class="form-select" id="Input_State">
                    <option selected>Choose...</option>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AS">American Samoa</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="UM-81">Baker Island</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="DC">District of Columbia</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="GU">Guam</option>
                    <option value="HI">Hawaii</option>
                    <option value="UM-84">Howland Island</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="UM-86">Jarvis Island</option>
                    <option value="UM-67">Johnston Atoll</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="UM-89">Kingman Reef</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="UM-71">Midway Atoll</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="UM-76">Navassa Island</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="MP">Northern Mariana Islands</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="UM-95">Palmyra Atoll</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="PR">Puerto Rico</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UM">United States Minor Outlying Islands</option>
                    <option value="VI">United States Virgin Islands</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="UM-79">Wake Island</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
                <label for="Input.State" class="form-label">State</label>
                <span asp-validation-for="Input.State" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.PostalCode" type="text" class="form-control" id="Input_PostalCode" placeholder="Zip">
                <label for="Input.PostalCode" class="form-label">Zip</label>
                <span asp-validation-for="Input.PostalCode" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.Password" type="password" class="form-control" id="Input_Password" placeholder="Password" autocomplete="new-password">
                <label for="Input.Password" class="form-label">Password</label>
                <span asp-validation-for="Input.Password" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <input asp-for="Input.ConfirmPassword" type="password" class="form-control" id="Input_ConfirmPassword" placeholder="Confirm Password" autocomplete="new-password">
                <label for="Input.ConfirmPassword" class="form-label">Confirm Password</label>
                <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
            </div>
            <div class="form-floating mb-3">
                <select asp-for="Input.Role" asp-items="@Model.Input.RoleList" class="form-select">
                    <option disabled selected>-Select Role-</option>
                </select>
                <label for="Input.Role" class="form-label">Role</label>
            </div>
            <input type="hidden" asp-for="Input.LId" id="Input_LId" />
            <input type="hidden" asp-for="Input.LeagueName" id="Input_LeagueName" />
            <h4>User Acknowledgment and Agreement</h4>
            <p>By using the Golf League Wizard app, I acknowledge that I have read, understood, and agree to the <a href="~/Identity/Account/PrivacyPolicy">Privacy Policy</a> and <a href="~/Identity/Account/TermsOfService">Terms of Service</a>.</p>
            <div>
                <input type="checkbox" id="AcceptedConditions" asp-for="Input.AcceptedConditions" required />
                <label for="AcceptedConditions">I acknowledge and agree to all of the above conditions.</label>
            </div>
            <br />
            <h4>Text Message Acceptance</h4>
            <div>
                <P> I
                <select id="SmsConsentSelect" asp-for="Input.SmsConsent" required>
                    <option value="do">do</option>
                    <option value="do not">do not</option>
                </select>
                agree to receive SMS alerts and notifications (text messages) from Golf League Wizard LLC. To "Opt Out" select "do not" from the drop down or reply STOP to unsubscribe when you receive a notification.</P>
            </div>
            <br />
            <button id="registerSubmit" type="submit" class="btn btn-primary btn-lg">Register</button>
        </form>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="leaguesModal" tabindex="-1" aria-labelledby="leaguesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="leaguesModalLabel">Select Golf League</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Please select a golf league:</p>
                <select id="leagueSelect" class="form-select">
                    <!-- Leagues will be dynamically populated here -->
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="selectLeagueBtn">Select</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        'use strict';
        $(document).ready(function () {
            $('#Input_Email').blur(function () {
                var userEmail = $('#Input_Email').val();
                $.ajax({
                    url: '/Identity/Account/Register?handler=GolfLeagues',
                    method: 'GET',
                    data: { userEmail: userEmail },
                    success: function (data) {
                        if (data.length > 1) {
                            $('#leaguesModal').modal('show');
                            var $leagueSelect = $('#leagueSelect');
                            $leagueSelect.empty();
                            $.each(data, function (index, league) {
                                $leagueSelect.append($('<option>', {
                                    value: league.lId,
                                    text: league.leagueName
                                }));
                            });
                        } else if (data.length === 1) {
                            $('#Input_LeagueName').val(data[0].leagueName);
                            $('#Input_LId').val(data[0].lId);
                        }
                    },
                    error: function (error) {
                        console.error('Error loading golf leagues:', error);
                    }
                });
            });

            $('#selectLeagueBtn').click(function () {
                var selectedLeagueId = $('#leagueSelect').val();
                var selectedLeagueName = $('#leagueSelect option:selected').text();
                $('#Input_LeagueName').val(selectedLeagueName);
                $('#Input_LId').val(selectedLeagueId);
                $('#SelectedLeagueName').val(selectedLeagueName);
                $('#leaguesModal').modal('hide');
            });
        });
    </script>
}
